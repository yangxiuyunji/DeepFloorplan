# DeepFloorplan 部署指南

## 📋 系统要求

### 硬件要求
- **CPU**: Intel/AMD 64位处理器，建议4核心以上
- **内存**: 最低8GB RAM，推荐16GB以上
- **存储**: 至少10GB可用空间
- **GPU**: 可选，但由于CUDA版本兼容性问题，建议使用CPU模式

### 软件要求
- **操作系统**: Windows 10/11 64位
- **Python**: 3.8-3.12版本
- **Git**: 用于代码下载（可选）

## 🚀 快速部署步骤

### 步骤1: 准备Python环境

#### 方案A: 使用Anaconda（推荐）
```bash
# 下载并安装Anaconda
# https://www.anaconda.com/products/distribution

# 创建专用环境
conda create -n deepfloorplan python=3.9
conda activate deepfloorplan
```

#### 方案B: 使用系统Python
```bash
# 确保Python版本3.8-3.12
python --version

# 创建虚拟环境
python -m venv deepfloorplan_env
deepfloorplan_env\Scripts\activate
```

### 步骤2: 获取代码

#### 方案A: 直接复制（推荐）
```bash
# 将整个DeepFloorplan文件夹复制到目标电脑
# 包含所有文件和子文件夹
```

#### 方案B: Git克隆
```bash
git clone https://github.com/yangxiuyunji/DeepFloorplan.git
cd DeepFloorplan
```

### 步骤3: 安装依赖

```bash
# 进入项目目录
cd DeepFloorplan

# 升级pip
python -m pip install --upgrade pip

# 安装基础依赖
pip install -r requirements.txt

# 安装PaddleOCR
pip install paddleocr

# 可能需要的额外依赖
pip install opencv-python
pip install Pillow
pip install matplotlib
```

### 步骤4: 验证安装

```bash
# 测试基本功能
python demo_fixed.py

# 如果成功，应该看到类似输出：
# 🚀 PaddleOCR可用，将优先使用
# ✅ PaddleOCR专业优化模式初始化完成
```

## 📁 必要文件清单

确保以下文件和目录存在：

### 核心文件
```
DeepFloorplan/
├── demo_fixed.py           # 主程序（优化版）
├── demo.py                 # 原始主程序
├── net_fixed.py            # 网络模型（优化版）
├── net.py                  # 原始网络模型
├── postprocess.py          # 后处理模块
├── preprocess.py           # 预处理模块
├── requirements.txt        # 依赖清单
└── utils/
    └── ocr_enhanced.py     # 增强OCR模块
```

### 模型文件
```
pretrained/
├── checkpoint
├── pretrained_r3d.data-00000-of-00001
├── pretrained_r3d.index
└── pretrained_r3d.meta
```

### 测试数据
```
demo/
├── demo.jpg
├── demo1.jpg
├── demo2.jpg
└── demo3.jpg
```

### 配置文档
```
├── PaddleOCR配置优化指南.md
├── 部署指南.md
├── 环境配置说明.md
└── 颜色编码说明.md
```

## 🔧 常见问题解决

### 问题1: PaddleOCR安装失败
```bash
# 解决方案1: 使用国内镜像
pip install paddleocr -i https://pypi.tuna.tsinghua.edu.cn/simple/

# 解决方案2: 分步安装
pip install paddlepaddle
pip install paddleocr
```

### 问题2: TensorFlow版本冲突
```bash
# 卸载现有版本
pip uninstall tensorflow tensorflow-gpu

# 安装指定版本
pip install tensorflow==2.10.0
```

### 问题3: OpenCV错误
```bash
# 重新安装OpenCV
pip uninstall opencv-python opencv-contrib-python
pip install opencv-python
```

### 问题4: 权限错误
```bash
# Windows: 以管理员身份运行PowerShell
# 或添加 --user 参数
pip install --user paddleocr
```

### 问题5: GPU不可用
这是正常现象，系统会自动使用CPU模式：
```
💻 设备状态: CPU模式
🔧 使用CPU计算
```

## ⚡ 性能优化建议

### CPU优化
```bash
# 设置OpenMP线程数
set OMP_NUM_THREADS=4

# 设置TensorFlow CPU线程
set TF_NUM_INTEROP_THREADS=4
set TF_NUM_INTRAOP_THREADS=4
```

### 内存优化
```bash
# 限制TensorFlow内存使用
set TF_FORCE_GPU_ALLOW_GROWTH=true
```

## 📊 验证部署成功

### 基本功能测试
```bash
# 测试默认图片
python demo_fixed.py

# 测试指定图片
python demo_fixed.py demo/demo1.jpg

# 测试处理后的结果检查
# 应该在demo/目录下生成结果文件
```

### 预期输出示例
```
🚀 PaddleOCR可用，将优先使用
✅ PaddleOCR专业优化模式初始化完成
   📋 官方最佳实践参数:
   🔹 det_db_thresh=0.2 (更敏感的像素检测)
   🔹 det_db_box_thresh=0.4 (减少漏检)
   🔹 det_db_unclip_ratio=2.5 (官方推荐扩张系数)
   🔹 use_dilation=True (膨胀处理提升效果)
   🔹 det_db_score_mode='slow' (精确得分计算)
💻 设备状态: CPU模式
🔧 使用CPU计算
🍳 OCR检测到厨房文字: '厨房' (置信度: 0.997)
✅ 带厨房标记的结果已保存
📸 结果已保存: demo2_result.png
```

## 🎯 一键部署脚本

创建 `setup.bat` 文件（Windows）：

```batch
@echo off
echo 开始部署DeepFloorplan...

REM 检查Python
python --version >nul 2>&1
if errorlevel 1 (
    echo 错误: 未找到Python，请先安装Python 3.8-3.12
    pause
    exit /b 1
)

REM 升级pip
echo 升级pip...
python -m pip install --upgrade pip

REM 安装依赖
echo 安装基础依赖...
pip install -r requirements.txt

echo 安装PaddleOCR...
pip install paddleocr

echo 安装额外依赖...
pip install opencv-python Pillow matplotlib

REM 测试安装
echo 测试安装结果...
python demo_fixed.py

echo 部署完成！
pause
```

## 📞 技术支持

如果在部署过程中遇到问题：

1. **检查Python版本**: `python --version`
2. **检查pip版本**: `pip --version`
3. **查看错误日志**: 保存完整的错误信息
4. **检查网络连接**: 确保能够下载依赖包
5. **检查磁盘空间**: 确保有足够的存储空间

## � 文件清单和打包说明

### 🔧 核心程序文件
```
✅ demo_fixed.py           # 主程序（优化版本）
✅ demo.py                 # 原始主程序  
✅ net_fixed.py            # 神经网络模型（优化版本）
✅ net.py                  # 原始神经网络模型
✅ postprocess.py          # 后处理模块
✅ preprocess.py           # 预处理模块
✅ requirements.txt        # Python依赖清单
```

### 🧠 AI模型文件
```
✅ pretrained/
   ├── checkpoint
   ├── pretrained_r3d.data-00000-of-00001
   ├── pretrained_r3d.index
   └── pretrained_r3d.meta
```

### 🔍 增强功能模块
```
✅ utils/
   └── ocr_enhanced.py     # PaddleOCR增强模块
```

### 🖼️ 测试数据
```
✅ demo/
   ├── demo.jpg            # 测试图片1
   ├── demo1.jpg           # 测试图片2（高质量户型图）
   ├── demo2.jpg           # 测试图片3
   └── demo3.jpg           # 测试图片4
```

### 📚 文档和脚本
```
✅ 部署指南.md             # 完整部署说明
✅ 环境配置指南.md         # 环境配置详细说明
✅ 颜色编码说明.md         # 颜色编码解释
✅ PaddleOCR配置优化指南.md # OCR参数优化指南
✅ setup.bat               # 一键部署脚本
✅ README.md               # 项目说明
✅ LICENSE                 # 开源协议
```

### 📂 完整目录结构
```
DeepFloorplan/
├── 📁 demo/                    # 测试图片目录
│   ├── demo.jpg
│   ├── demo1.jpg
│   ├── demo2.jpg
│   └── demo3.jpg
├── 📁 output/                  # 输出结果目录（自动创建）
├── 📁 pretrained/              # 预训练模型目录
│   ├── checkpoint
│   ├── pretrained_r3d.data-00000-of-00001
│   ├── pretrained_r3d.index
│   └── pretrained_r3d.meta
├── 📁 utils/                   # 工具模块目录
│   └── ocr_enhanced.py
├── 📄 demo_fixed.py            # 🎯 主程序
├── 📄 net_fixed.py             # 🧠 神经网络
├── 📄 postprocess.py           # ⚙️ 后处理
├── 📄 preprocess.py            # ⚙️ 预处理
├── 📄 requirements.txt         # 📋 依赖清单
├── 📄 setup.bat                # 🚀 部署脚本
├── 📄 部署指南.md              # 📖 部署说明
├── 📄 环境配置指南.md          # 📖 环境配置
├── 📄 颜色编码说明.md          # 📖 颜色说明
└── 📄 PaddleOCR配置优化指南.md # 📖 OCR指南
```

### 📊 文件大小估算
| 文件类型 | 大小范围 | 说明 |
|----------|----------|------|
| Python代码 | ~100KB | 所有.py文件 |
| 预训练模型 | ~500MB | TensorFlow模型文件 |
| 测试图片 | ~10MB | demo目录下图片 |
| 文档说明 | ~100KB | 所有.md文件 |
| **总计** | **~510MB** | 完整部署包 |

### ✅ 部署前检查清单
在打包之前，请确认：
- [ ] 所有必需文件都存在
- [ ] pretrained目录完整
- [ ] utils/ocr_enhanced.py存在
- [ ] setup.bat可执行
- [ ] 测试图片可用
- [ ] 文档齐全

## �🔄 更新维护

### 定期更新
```bash
# 更新PaddleOCR
pip install --upgrade paddleocr

# 更新其他依赖
pip install --upgrade -r requirements.txt
```

### 备份重要文件
- 备份自定义配置文件
- 备份测试图片和结果
- 备份预训练模型文件

---

**部署成功标志**: 能够成功运行 `python demo_fixed.py` 并生成结果图片

**技术特点**: 
- ✅ 优化的PaddleOCR参数配置
- ✅ 智能厨房识别算法  
- ✅ CPU模式稳定运行
- ✅ 中文房间名称识别
- ✅ 完整的错误处理机制
